(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/cropper/cropper"],{"2add":function(t,i,e){"use strict";e.r(i);var s=e("2b2b"),h=e("cdb5");for(var a in h)"default"!==a&&function(t){e.d(i,t,function(){return h[t]})}(a);e("a768");var o=e("2877"),n=Object(o["a"])(h["default"],s["a"],s["b"],!1,null,null,null);i["default"]=n.exports},"2b2b":function(t,i,e){"use strict";var s=function(){var t=this,i=t.$createElement;t._self._c},h=[];e.d(i,"a",function(){return s}),e.d(i,"b",function(){return h})},"6b69":function(t,i,e){"use strict";(function(t){e("5dfb"),e("921b");s(e("66fd"));var i=s(e("2add"));function s(t){return t&&t.__esModule?t:{default:t}}t(i.default)}).call(this,e("543d")["createPage"])},"957f":function(t,i,e){},a768:function(t,i,e){"use strict";var s=e("957f"),h=e.n(s);h.a},cdb5:function(t,i,e){"use strict";e.r(i);var s=e("db3c"),h=e.n(s);for(var a in s)"default"!==a&&function(t){e.d(i,t,function(){return s[t]})}(a);i["default"]=h.a},db3c:function(t,i,e){"use strict";(function(t){Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var s=h(e("a34a"));function h(t){return t&&t.__esModule?t:{default:t}}function a(t,i,e,s,h,a,o){try{var n=t[a](o),r=n.value}catch(l){return void e(l)}n.done?i(r):Promise.resolve(r).then(s,h)}function o(t){return function(){var i=this,e=arguments;return new Promise(function(s,h){var o=t.apply(i,e);function n(t){a(o,s,h,n,r,"next",t)}function r(t){a(o,s,h,n,r,"throw",t)}n(void 0)})}}var n=70,r={name:"cropper",data:function(){return{cvsStyleHeight:"0px",styleDisplay:"none",styleTop:"-10000px",prvTop:"-10000px",imgStyle:{},selStyle:{},showOper:!0,imgSrc:{imgSrc:""},qlty:.9,postWidthFirst:{},selWidth:"600rpx",selHeight:"600rpx"}},onLoad:function(){this.fSelect()},watch:{avatarSrc:function(){this.imgSrc.imgSrc=this.avatarSrc}},props:{avatarSrc:"",avatarStyle:"",expWidth:"",expHeight:"",minScale:"",maxScale:"",canScale:"",noTab:"",quality:"",index:""},created:function(){var i=this;this.ctxCanvas=t.createCanvasContext("avatar-canvas",this),this.ctxCanvasOper=t.createCanvasContext("oper-canvas",this),this.qlty=parseInt(this.quality)||.9,this.imgSrc.imgSrc=this.avatarSrc,this.letScale="false"===this.canScale?0:1,this.indx=this.index||void 0,this.mnScale=this.minScale||.3,this.mxScale=this.maxScale||4,this.noBar="true"===this.noTab?1:0,this.noBar?(this.moreHeight=0,this.fWindowResize()):t.showTabBar({complete:function(t){i.moreHeight="showTabBar:ok"===t.errMsg?50:0,i.fWindowResize()}})},methods:{fWindowResize:function(){var i=t.getSystemInfoSync();this.platform=i.platform,this.pixelRatio=i.pixelRatio,this.windowWidth=i.windowWidth,this.windowHeight=i.windowHeight,this.cvsStyleHeight=this.windowHeight-n+"px",this.cvsStyleHeight=this.windowHeight-n+"px",this.pxRatio=this.windowWidth/750;var e=this.avatarStyle;this.imgStyle=e,this.expWidth&&(this.exportWidth=this.expWidth.indexOf("rpx")>=0?parseInt(this.expWidth)*this.pxRatio:parseInt(this.expWidth)),this.expHeight&&(this.exportHeight=this.expHeight.indexOf("rpx")>=0?parseInt(this.expHeight)*this.pxRatio:parseInt(this.expHeight)),"flex"===this.styleDisplay&&this.fDrawInit(!0),this.fHideImg()},fSelect:function(){var i=this;this.fSelecting||(this.fSelecting=!0,setTimeout(function(){i.fSelecting=!1},500),t.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["camera","album"],success:function(e){t.showLoading({mask:!0});var s=i.imgPath=e.tempFilePaths[0];t.getImageInfo({src:s,success:function(e){if(i.imgWidth=e.width,i.imgHeight=e.height,i.path=s,!i.hasSel){var h=i.selStyle||{};if(!i.selWidth||!i.selHeight)return void t.showModal({title:"裁剪框的宽或高没有设置",showCancel:!1});var a=i.selWidth.indexOf("rpx")>=0?parseInt(i.selWidth)*i.pxRatio:parseInt(i.selWidth),o=i.selHeight.indexOf("rpx")>=0?parseInt(i.selHeight)*i.pxRatio:parseInt(i.selHeight);h.width=parseInt(a),h.height=parseInt(o),h.top=parseInt((i.windowHeight-h.height-n)/2),h.left=parseInt((i.windowWidth-h.width)/2),i.selStyle=h}i.noBar?i.fDrawInit(!0):t.hideTabBar({complete:function(){i.fDrawInit(!0)}})},fail:function(){t.showToast({title:"error3",duration:2e3})},complete:function(){t.hideLoading()}})}}))},fUpload:function(){var i=this;if(!this.fUploading){this.fUploading=!0,setTimeout(function(){i.fUploading=!1},1e3);var e=this.selStyle,s=parseInt(e.left),h=parseInt(e.top),a=parseInt(e.width),o=parseInt(e.height),n=this.exportWidth||a,r=this.exportHeight||o;this.styleDisplay="none",this.styleTop="-10000px",this.hasSel=!1,this.fHideImg(),t.canvasToTempFilePath({x:s,y:h,width:a,height:o,destWidth:n,destHeight:r,canvasId:"avatar-canvas",fileType:"png",quality:this.qlty,success:function(i){i=i.tempFilePath,t.redirectTo({url:"../meUploadImg/meUploadImg?temp="+i})},fail:function(i){t.showToast({title:"error1",duration:2e3})},complete:function(){i.noBar||t.showTabBar()}},this)}},fDrawInit:function(){var t=this,i=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=this.windowWidth,s=this.windowHeight,h=this.imgWidth,a=this.imgHeight,o=h/a,r=e,l=s-n,c=(this.pixelRatio,parseInt(this.selStyle.width)),p=parseInt(this.selStyle.height);this.fixWidth=0,this.fixHeight=0,this.fixWidth?(r=c,l=r/o):this.fixHeight?(l=p,r=l*o):o<1?(r=c,l=parseInt(r/o)):(l=p,r=parseInt(l*o)),this.scaleSize=1,this.rotateDeg=0,this.posWidth=parseInt((e-r)/2),this.posHeight=parseInt((s-l-n)/2),this.useWidth=r,this.useHeight=l;var d=this.selStyle,f=parseInt(d.left),u=parseInt(d.top),g=parseInt(d.width),w=parseInt(d.height),m=(this.canvas,this.canvasOper,this.ctxCanvas),v=this.ctxCanvasOper;v.setFillStyle("rgba(0,0,0, 0.5)"),v.fillRect(0,0,this.windowWidth,u),v.fillRect(0,u,f,w),v.fillRect(0,u+w,this.windowWidth,this.windowHeight-w-n-u),v.fillRect(f+g,u,this.windowWidth-g-f,w),v.setLineWidth(1),v.setStrokeStyle("rgba(255, 255, 255,1)"),v.strokeRect(f,u,g,w),v.setLineWidth(3),v.setStrokeStyle("rgba(255, 255, 255, 1)"),v.moveTo(f+20,u),v.lineTo(f,u),v.lineTo(f,u+20),v.moveTo(f+g-20,u),v.lineTo(f+g,u),v.lineTo(f+g,u+20),v.moveTo(f+20,u+w),v.lineTo(f,u+w),v.lineTo(f,u+w-20),v.moveTo(f+g-20,u+w),v.lineTo(f+g,u+w),v.lineTo(f+g,u+w-20),v.stroke(),this.postFirst={left:f,top:u,width:g,height:c,posWidth:this.posWidth,posHeight:this.posHeight},v.draw(!1,function(){i&&(t.styleDisplay="flex",t.styleTop="0",m.setFillStyle("black"),t.fDrawImage())}),this.$emit("avtinit")},fDrawImage:function(){var t=Date.now();if(!(t-this.drawTm<20)){this.drawTm=t;var i=this.ctxCanvas;i.fillRect(0,0,this.windowWidth,this.windowHeight-n),i.translate(this.posWidth+this.useWidth/2,this.posHeight+this.useHeight/2),i.scale(this.scaleSize,this.scaleSize),i.drawImage(this.imgPath,-this.useWidth/2,-this.useHeight/2,this.useWidth,this.useHeight),i.draw(!1)}},fHideImg:function(){this.prvImg="",this.prvTop="-10000px",this.showOper=!0,this.prvImgData=null,this.target=null},fClose:function(){t.navigateTo({url:"../meInfo/meInfo"})},fStart:function(t){var i=t.touches,e=i[0],s=i[1];if(this.touch0=e,this.touch1=s,s){var h=s.x-e.x,a=s.y-e.y;this.fgDistance=Math.sqrt(h*h+a*a)}},fMove:function(t){var i=t.touches,e=i[0],s=i[1];if(s){var h=s.x-e.x,a=s.y-e.y,o=Math.sqrt(h*h+a*a),n=.005*(o-this.fgDistance),r=this.scaleSize+n;do{if(!this.letScale)break;if(r<this.mnScale)break;if(r>this.mxScale)break;this.scaleSize=r}while(0);this.fgDistance=o,s.x!==e.x&&this.letRotate&&(h=(this.touch1.y-this.touch0.y)/(this.touch1.x-this.touch0.x),a=(s.y-e.y)/(s.x-e.x),this.rotateDeg+=180*Math.atan((a-h)/(1+h*a))/Math.PI,this.touch0=e,this.touch1=s),this.fDrawImage()}else if(this.touch0){var l=e.x-this.touch0.x,c=e.y-this.touch0.y,p=this.posWidth+l,d=this.posHeight+c;Math.abs(l)<100&&!this.lckWidth&&(this.posWidth=p),Math.abs(c)<100&&!this.lckHeight&&(this.posHeight=d),this.touch0=e,this.fDrawImage()}},fEnd:function(){var t=o(s.default.mark(function t(i){var e,h,a,o,n,r,l,c,p;return s.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:e=this,h=i.touches,a=h&&h[0],h&&h[1],e.scaleSize<1?(o=e.selStyle,n=e.imgWidth/e.imgHeight,n<1&&e.scaleSize*e.useWidth<o.width?(e.posWidth=o.left,e.scaleSize=1,setTimeout(function(){e.fDrawImage()},100)):e.scaleSize*e.useHeight<o.width&&(e.posHeight=o.top,e.scaleSize=1,setTimeout(function(){e.fDrawImage()},100))):1==this.scaleSize&&(r=this.posWidth-this.postFirst.posWidth,l=this.postFirst.left-this.postFirst.posWidth,c=this.posHeight-this.postFirst.posHeight,p=this.postFirst.top-this.postFirst.posHeight,r>0&&this.posWidth>this.postFirst.left?this.posWidth=this.postFirst.left:r<0&&r<l&&(this.posWidth=-this.postFirst.left+2*this.postFirst.posWidth),c<0&&this.posHeight<this.postFirst.top?this.posHeight=-this.postFirst.top+2*this.postFirst.posHeight:c>0&&c>p&&(this.posHeight=this.postFirst.top),setTimeout(function(){e.fDrawImage()},100)),a?this.touch0=a:(this.touch0=null,this.touch1=null);case 4:case"end":return t.stop()}},t,this)}));function i(i){return t.apply(this,arguments)}return i}(),btop:function(t){return new Promise(function(i,e){var s=t.split(","),h=s[0].match(/:(.*?);/)[1],a=atob(s[1]),o=a.length,n=new Uint8Array(o);while(o--)n[o]=a.charCodeAt(o);return i((window.URL||window.webkitURL).createObjectURL(new Blob([n],{type:h})))})}}};i.default=r}).call(this,e("543d")["default"])}},[["6b69","common/runtime","common/vendor"]]]);